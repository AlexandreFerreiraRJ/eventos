(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{M9Qw:function(n,e,t){"use strict";t.r(e);var o=t("jx1L"),r=t("WPQR"),a=t("L2JU");function i(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}var s={name:"people",uri:"people",performLoad:!1},l={props:["mode"],mixins:[o.a,r.a],data:function(){return{service:s,photo:null,photoUrl:"https://dummyimage.com/200x200/fff/aaa",photoBlob:null,showCropper:!1,currentNameIsDuplicate:!1}},methods:function(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{},o=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(t).filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),o.forEach(function(e){i(n,e,t[e])})}return n}({},Object(a.mapActions)(s.name,["selectPerson"]),{generatePhoto:function(){var n=this;this.mutatePhotoUrl(this.photo.generateDataUrl()),this.photo.generateBlob(function(e){n.mutatePhoto(e)},"image/jpeg",.85)},usePhoto:function(){this.generatePhoto(),this.showCropper=!1},mutatePhoto:function(n){var e=this;blob_to_base64(n,function(t){e.mutateSetFormField({field:"photo",value:n.type+";"+t})})},mutatePhotoUrl:function(n){this.mutateSetFormField({field:"photoUrl",value:n})},flushImageCache:function(n){return flush_image_cache(n)},verifyDuplicateName:function(n){var e=this;clearTimeout(this.timeout),this.currentNameIsDuplicate=!1,this.timeout=setTimeout(function(){post("/api/v1/people/validate-name",{name:n}).catch(function(n){e.currentNameIsDuplicate=!0,console.log(n)})},500)},confirmNameDuplicate:function(){var n=this;confirm("Deseja realmente cadastrar novamente o nome: "+this.form.fields.name+"?",this).then(function(e){e&&n.saveModel()})},savePerson:function(){this.currentNameIsDuplicate?this.confirmNameDuplicate():this.saveModel()}}),computed:{photoUrlField:function(){return flush_image_cache(this.form.fields.photoUrl)}}},c=(t("RFgL"),t("KHd+")),u=Object(c.a)(l,function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("div",[t("div",{staticClass:"py-2 text-center"},[t("h2",[n._v(n._s("create"===this.mode?"Nova ":"Editar ")+"Pessoa")]),n._v(" "),t("h2",[n._v(n._s(n.form.fields.name?n.form.fields.name:""))])]),n._v(" "),t("div",{staticClass:"row justify-content-center"},[t("div",{staticClass:"col-8"},[t("form",[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12"},[t("img",{staticClass:"img-thumbnail rounded mx-auto d-block",attrs:{src:n.makePhotoUrl(),width:"200",height:"200"},on:{click:function(e){n.showCropper=!0}}}),n._v(" "),t("p",[n._v(n._s(n.form.fields.photoUrl))]),n._v(" "),t("b-modal",{attrs:{id:"croppaModal","body-class":"mx-auto",centered:""},model:{value:n.showCropper,callback:function(e){n.showCropper=e},expression:"showCropper"}},[t("vue-croppa",{attrs:{placeholder:"Selecione uma imagem",width:400,height:400,"prevent-white-space":!0},model:{value:n.photo,callback:function(e){n.photo=e},expression:"photo"}}),n._v(" "),t("div",{staticClass:"w-100",attrs:{slot:"modal-footer"},slot:"modal-footer"},[t("div",{staticClass:"float-right btn btn-success",on:{click:function(e){n.showCropper=!1}}},[n._v("\n                                    Cancelar\n                                ")]),n._v(" "),t("div",{staticClass:"float-right btn btn-outline-secondary mr-2",on:{click:function(e){n.usePhoto()}}},[n._v("\n                                    OK\n                                ")])])],1)],1)]),n._v(" "),t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 mb-3"},[t("label",{staticClass:"mb-0 mt-2",attrs:{for:"name"}},[n._v("Nome")]),n._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:n.form.fields.name,expression:"form.fields.name"}],staticClass:"form-control",attrs:{name:"name",id:"name",required:"required"},domProps:{value:n.form.fields.name},on:{keyup:function(e){n.verifyDuplicateName(n.form.fields.name)},input:function(e){e.target.composing||n.$set(n.form.fields,"name",e.target.value)}}}),n._v(" "),n.form.errors.has("name")?t("div",{staticClass:"text-danger"},[n._v("\n                            "+n._s(n.form.errors.get("name"))+"\n                        ")]):n._e(),n._v(" "),n.currentNameIsDuplicate?t("div",{staticClass:"alert alert-warning",attrs:{role:"alert",id:"nameDuplicate"}},[n._v("\n                            Foi encontrado uma pessoa com este mesmo nome:\n                            "+n._s(n.form.fields.name)+", recomenda-se verificar\n                            as pessoas cadastradas.\n                        ")]):n._e(),n._v(" "),t("app-input",{directives:[{name:"mask",rawName:"v-mask",value:"###.###.###-##",expression:"'###.###.###-##'"}],attrs:{name:"cpf",label:"CPF",required:!1,form:n.form},model:{value:n.form.fields.cpf,callback:function(e){n.$set(n.form.fields,"cpf",e)},expression:"form.fields.cpf"}}),n._v(" "),t("app-input",{attrs:{name:"nickname",label:"Nome pÃºblico",required:!0,form:n.form},model:{value:n.form.fields.nickname,callback:function(e){n.$set(n.form.fields,"nickname",e)},expression:"form.fields.nickname"}}),n._v(" "),t("app-input",{attrs:{name:"title",label:"Tratamento",required:!0,form:n.form},model:{value:n.form.fields.title,callback:function(e){n.$set(n.form.fields,"title",e)},expression:"form.fields.title"}}),n._v(" "),t("app-input",{attrs:{name:"birthdate",label:"Data de nascimento",type:"date",form:n.form},model:{value:n.form.fields.birthdate,callback:function(e){n.$set(n.form.fields,"birthdate",e)},expression:"form.fields.birthdate"}})],1)]),n._v(" "),t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 text-right mb-3"},[t("button",{staticClass:"btn btn-outline-secondary",attrs:{type:"submit"},on:{click:function(e){e.preventDefault(),n.savePerson()}}},[n._v("\n                            gravar\n                        ")]),n._v(" "),t("router-link",{staticClass:"btn btn-success",attrs:{to:"/people",tag:"button"}},[n._v("\n                            cancelar\n                        ")])],1)])])])])])},[],!1,null,null,null);u.options.__file="PeopleForm.vue";e.default=u.exports},RFgL:function(n,e,t){"use strict";var o=t("iB00");t.n(o).a},WPQR:function(n,e,t){"use strict";var o=t("L2JU");function r(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{},o=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(t).filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),o.forEach(function(e){a(n,e,t[e])})}return n}function a(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}e.a={data:function(){return{people_current:{id:"null"}}},methods:r({},Object(o.mapActions)("people",["clearForm"]),{makePhotoUrl:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;n||(n=this.people.form.fields.photoUrl),n||(n=this.people.selected.photoUrl);var e=this.people_current.id!=this.people.selected.id;return this.people_current.id=this.people.selected.id,flush_image_cache(n,e)}}),computed:r({},Object(o.mapState)({people:function(n){return n.people},personInstitutions:function(n){return n.personInstitutions},contacts:function(n){return n.contacts},addresses:function(n){return n.addresses},personCategories:function(n){return n.personCategories},advisors:function(n){return n.advisors},advisorContacts:function(n){return n.advisorContacts}}))}},iB00:function(n,e,t){var o=t("v9lD");"string"==typeof o&&(o=[[n.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};t("aET+")(o,r);o.locals&&(n.exports=o.locals)},v9lD:function(n,e,t){(n.exports=t("I1BE")(!1)).push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",""])}}]);
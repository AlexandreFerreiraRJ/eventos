(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{M9Qw:function(t,n,e){"use strict";e.r(n);var i=e("jx1L"),r=e("WPQR"),o=e("L2JU");function s(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}var a={name:"people",uri:"people",performLoad:!1},c={props:["mode"],mixins:[i.a,r.a],data:function(){return{service:a,photo:null,photoUrl:"https://dummyimage.com/200x200/fff/aaa",photoBlob:null,showCropper:!1,currentNameIsDuplicate:!1}},methods:function(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{},i=Object.keys(e);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(e).filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.forEach(function(n){s(t,n,e[n])})}return t}({},Object(o.mapActions)(a.name,["selectPerson"]),{generatePhoto:function(){var t=this;this.mutatePhotoUrl(this.photo.generateDataUrl()),this.photo.generateBlob(function(n){t.mutatePhoto(n)},"image/jpeg",.85)},usePhoto:function(){this.generatePhoto(),this.showCropper=!1},mutatePhoto:function(t){var n=this;blob_to_base64(t,function(e){n.mutateSetFormField({field:"photo",value:t.type+";"+e})})},mutatePhotoUrl:function(t){this.mutateSetFormField({field:"photoUrl",value:t})},flushImageCache:function(t){return flush_image_cache(t)},verifyDuplicateName:function(t){var n=this;clearTimeout(this.timeout),this.currentNameIsDuplicate=!1,this.timeout=setTimeout(function(){post("/api/v1/people/validate-name",{name:t}).catch(function(t){n.currentNameIsDuplicate=!0,console.log(t)})},500)},confirmNameDuplicate:function(){var t=this;confirm("Deseja realmente cadastrar novamente o nome: "+this.form.fields.name+"?",this).then(function(n){n&&t.saveModel()})},savePerson:function(){this.currentNameIsDuplicate?this.confirmNameDuplicate():this.saveModel()}}),computed:{photoUrlField:function(){return flush_image_cache(this.form.fields.photoUrl)}}},l=(e("RFgL"),e("KHd+")),u=Object(l.a)(c,function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",[e("div",{staticClass:"py-2 text-center"},[e("h2",[t._v(t._s("create"===this.mode?"Nova ":"Editar ")+"Pessoa")]),t._v(" "),e("h2",[t._v(t._s(t.form.fields.name?t.form.fields.name:""))])]),t._v(" "),e("div",{staticClass:"row justify-content-center"},[e("div",{staticClass:"col-8"},[e("form",[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12"},[e("img",{staticClass:"img-thumbnail rounded mx-auto d-block",attrs:{src:t.makePhotoUrl(),width:"200",height:"200"},on:{click:function(n){t.showCropper=!0}}}),t._v(" "),e("p",[t._v(t._s(t.form.fields.photoUrl))]),t._v(" "),e("b-modal",{attrs:{id:"croppaModal","body-class":"mx-auto",centered:""},model:{value:t.showCropper,callback:function(n){t.showCropper=n},expression:"showCropper"}},[e("vue-croppa",{attrs:{placeholder:"Selecione uma imagem",width:400,height:400,"prevent-white-space":!0},model:{value:t.photo,callback:function(n){t.photo=n},expression:"photo"}}),t._v(" "),e("div",{staticClass:"w-100",attrs:{slot:"modal-footer"},slot:"modal-footer"},[e("div",{staticClass:"float-right btn btn-success",on:{click:function(n){t.showCropper=!1}}},[t._v("\n                                    Cancelar\n                                ")]),t._v(" "),e("div",{staticClass:"float-right btn btn-outline-secondary mr-2",on:{click:function(n){t.usePhoto()}}},[t._v("\n                                    OK\n                                ")])])],1)],1)]),t._v(" "),e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 mb-3"},[e("label",{staticClass:"mb-0 mt-2",attrs:{for:"name"}},[t._v("Nome")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.fields.name,expression:"form.fields.name"}],staticClass:"form-control",attrs:{name:"name",id:"name",required:"required"},domProps:{value:t.form.fields.name},on:{keyup:function(n){t.verifyDuplicateName(t.form.fields.name)},input:function(n){n.target.composing||t.$set(t.form.fields,"name",n.target.value)}}}),t._v(" "),t.form.errors.has("name")?e("div",{staticClass:"text-danger"},[t._v("\n                            "+t._s(t.form.errors.get("name"))+"\n                        ")]):t._e(),t._v(" "),t.currentNameIsDuplicate?e("div",{staticClass:"alert alert-warning",attrs:{role:"alert",id:"nameDuplicate"}},[t._v("\n                            Foi encontrado uma pessoa com este mesmo nome:\n                            "+t._s(t.form.fields.name)+", recomenda-se verificar\n                            as pessoas cadastradas.\n                        ")]):t._e(),t._v(" "),e("app-input",{directives:[{name:"mask",rawName:"v-mask",value:"###.###.###-##",expression:"'###.###.###-##'"}],attrs:{name:"cpf",label:"CPF",required:!1,form:t.form},model:{value:t.form.fields.cpf,callback:function(n){t.$set(t.form.fields,"cpf",n)},expression:"form.fields.cpf"}}),t._v(" "),e("app-input",{attrs:{name:"nickname",label:"Nome pÃºblico",required:!0,form:t.form},model:{value:t.form.fields.nickname,callback:function(n){t.$set(t.form.fields,"nickname",n)},expression:"form.fields.nickname"}}),t._v(" "),e("app-input",{attrs:{name:"title",label:"Tratamento",required:!0,form:t.form},model:{value:t.form.fields.title,callback:function(n){t.$set(t.form.fields,"title",n)},expression:"form.fields.title"}}),t._v(" "),e("app-input",{attrs:{name:"birthdate",label:"Data de nascimento",type:"date",form:t.form},model:{value:t.form.fields.birthdate,callback:function(n){t.$set(t.form.fields,"birthdate",n)},expression:"form.fields.birthdate"}})],1)]),t._v(" "),e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 text-right mb-3"},[e("button",{staticClass:"btn btn-outline-secondary",attrs:{type:"submit"},on:{click:function(n){n.preventDefault(),t.savePerson()}}},[t._v("\n                            gravar\n                        ")]),t._v(" "),e("router-link",{staticClass:"btn btn-success",attrs:{to:"/people",tag:"button"}},[t._v("\n                            cancelar\n                        ")])],1)])])])])])},[],!1,null,null,null);u.options.__file="PeopleForm.vue";n.default=u.exports},RFgL:function(t,n,e){"use strict";var i=e("iB00");e.n(i).a},WPQR:function(t,n,e){"use strict";var i=e("L2JU");function r(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{},i=Object.keys(e);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(e).filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.forEach(function(n){o(t,n,e[n])})}return t}function o(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}n.a={data:function(){return{people_current:{id:"null"}}},methods:r({},Object(i.mapActions)("people",["clearForm"]),{makePhotoUrl:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t||(t=this.people.form.fields.photoUrl),t||(t=this.people.selected.photoUrl);var n=this.people_current.id!=this.people.selected.id;return this.people_current.id=this.people.selected.id,flush_image_cache(t,n)}}),computed:r({},Object(i.mapState)({people:function(t){return t.people},personInstitutions:function(t){return t.personInstitutions},contacts:function(t){return t.contacts},addresses:function(t){return t.addresses},personCategories:function(t){return t.personCategories},advisors:function(t){return t.advisors},advisorContacts:function(t){return t.advisorContacts}}))}},iB00:function(t,n,e){var i=e("v9lD");"string"==typeof i&&(i=[[t.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};e("aET+")(i,r);i.locals&&(t.exports=i.locals)},jx1L:function(t,n,e){"use strict";n.a={data:function(){return{loading:{environment:!1,table:!1}}},computed:{filterText:{get:function(){return this.$store.state[this.service.name].data.filter.text},set:function(t){return this.$store.dispatch(this.service.name+"/mutateSetQueryFilterText",t)}},emptyForm:function(){return this.$store.state[this.service.name].emptyForm},form:function(){return this.$store.state[this.service.name].form},selected:function(){return this.$store.state[this.service.name].selected},environment:function(){return this.$store.state.environment},pagination:function(){return this.$store.state[this.service.name].data.links?this.$store.state[this.service.name].data.links.pagination:{}},perPage:{get:function(){return this.pagination.per_page},set:function(t){this.$store.dispatch(this.service.name+"/setPerPage",t)}}},methods:{load:function(){return this.$store.commit(this.service.name+"/mutateSetPerPage",this.environment.user.per_page),this.$store.dispatch(this.service.name+"/load")},select:function(t){return this.$store.dispatch(this.service.name+"/select",t)},save:function(t){return this.$store.dispatch(this.service.name+"/save",t)},mutateSetErrors:function(t){this.$store.commit(this.service.name+"/mutateSetErrors",t)},mutateFormData:function(t){this.$store.commit(this.service.name+"/mutateFormData",t)},mutateSetFormField:function(t){this.$store.commit(this.service.name+"/mutateSetFormField",t)},mutateSetService:function(t){this.$store.commit(this.service.name+"/mutateSetService",t)},isLoading:function(){return this.loading.environment||this.loading.table},boot:function(){var t=this;this.mutateSetService(this.service),!this.service.hasOwnProperty("performLoad")||this.service.performLoad?this.load().then(function(){t.fillFormWhenEditing()}):this.fillFormWhenEditing(),this.$store.dispatch(this.service.name+"/subscribeToTableEvents")},fillFormWhenEditing:function(){var t=this,n="update"===this.mode?_.find(this.rows,function(n){return n.id===t.$route.params.id}):this.form?clone(this.emptyForm):{};this.mutateFormData(n),this.mutateSetErrors({}),this.fillAdditionalFormFields()},fillAdditionalFormFields:function(){},back:function(){this.$router.back()},saveModel:function(){var t=this;this.save(this.mode).then(function(){t.back(),t.clearForm()})},gotoPage:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(e=e||this.pagination).current_page!==t&&(t<1||t>e.last_page||this.$store.dispatch((n||this.service.name)+"/setCurrentPage",t))},isCurrent:function(t,n){return t.id===n.id},setPerPage:function(){this.$store.commit(this.service.name+"/mutateSetPerPage",this.environment.user.per_page)},getDataUrl:function(){return buildApiUrl(this.service.uri,this.$store.state)},getStoreUrl:function(){return buildApiUrl(this.service.uri,this.$store.state)},getUpdateStoreUrl:function(){return buildApiUrl(this.service.uri,this.$store.state)}},mounted:function(){this.boot()}}},v9lD:function(t,n,e){(t.exports=e("I1BE")(!1)).push([t.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",""])}}]);
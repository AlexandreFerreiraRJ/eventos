(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{M9Qw:function(n,t,e){"use strict";e.r(t);var i=e("jx1L"),r=e("WPQR"),o=e("L2JU");function s(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}var a={name:"people",uri:"people",performLoad:!1},c={props:["mode"],mixins:[i.a,r.a],data:function(){return{service:a,photo:null,photoUrl:"https://dummyimage.com/200x200/fff/aaa",photoBlob:null,showCropper:!1,currentNameIsDuplicate:!1}},methods:function(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{},i=Object.keys(e);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(e).filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),i.forEach(function(t){s(n,t,e[t])})}return n}({},Object(o.mapActions)(a.name,["selectPerson"]),{generatePhoto:function(){var n=this;this.mutatePhotoUrl(this.photo.generateDataUrl()),this.photo.generateBlob(function(t){n.mutatePhoto(t)},"image/jpeg",.85)},usePhoto:function(){this.generatePhoto(),this.showCropper=!1},mutatePhoto:function(n){var t=this;blob_to_base64(n,function(e){t.mutateSetFormField({field:"photo",value:n.type+";"+e})})},mutatePhotoUrl:function(n){this.mutateSetFormField({field:"photoUrl",value:n})},flushImageCache:function(n){return flush_image_cache(n)},verifyDuplicateName:function(n){var t=this;clearTimeout(this.timeout),this.currentNameIsDuplicate=!1,this.timeout=setTimeout(function(){post("/api/v1/people/validate-name",{name:n}).catch(function(n){t.currentNameIsDuplicate=!0,console.log(n)})},500)},confirmNameDuplicate:function(){var n=this;confirm("Deseja realmente cadastrar novamente o nome: "+this.form.fields.name+"?",this).then(function(t){t&&n.saveModel()})},savePerson:function(){this.currentNameIsDuplicate?this.confirmNameDuplicate():this.saveModel()}}),computed:{photoUrlField:function(){return flush_image_cache(this.form.fields.photoUrl)}}},l=(e("RFgL"),e("KHd+")),u=Object(l.a)(c,function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("div",[e("div",{staticClass:"py-2 text-center"},[e("h2",[n._v(n._s("create"===this.mode?"Nova ":"Editar ")+"Pessoa")]),n._v(" "),e("h2",[n._v(n._s(n.form.fields.name?n.form.fields.name:""))])]),n._v(" "),e("div",{staticClass:"row justify-content-center"},[e("div",{staticClass:"col-8"},[e("form",[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12"},[e("img",{staticClass:"img-thumbnail rounded mx-auto d-block",attrs:{src:n.makePhotoUrl(),width:"200",height:"200"},on:{click:function(t){n.showCropper=!0}}}),n._v(" "),e("p",[n._v(n._s(n.form.fields.photoUrl))]),n._v(" "),e("b-modal",{attrs:{id:"croppaModal","body-class":"mx-auto",centered:""},model:{value:n.showCropper,callback:function(t){n.showCropper=t},expression:"showCropper"}},[e("vue-croppa",{attrs:{placeholder:"Selecione uma imagem",width:400,height:400,"prevent-white-space":!0},model:{value:n.photo,callback:function(t){n.photo=t},expression:"photo"}}),n._v(" "),e("div",{staticClass:"w-100",attrs:{slot:"modal-footer"},slot:"modal-footer"},[e("div",{staticClass:"float-right btn btn-success",on:{click:function(t){n.showCropper=!1}}},[n._v("\n                                    Cancelar\n                                ")]),n._v(" "),e("div",{staticClass:"float-right btn btn-outline-secondary mr-2",on:{click:function(t){n.usePhoto()}}},[n._v("\n                                    OK\n                                ")])])],1)],1)]),n._v(" "),e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 mb-3"},[e("label",{staticClass:"mb-0 mt-2",attrs:{for:"name"}},[n._v("Nome")]),n._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:n.form.fields.name,expression:"form.fields.name"}],staticClass:"form-control",attrs:{name:"name",id:"name",required:"required"},domProps:{value:n.form.fields.name},on:{keyup:function(t){n.verifyDuplicateName(n.form.fields.name)},input:function(t){t.target.composing||n.$set(n.form.fields,"name",t.target.value)}}}),n._v(" "),n.form.errors.has("name")?e("div",{staticClass:"text-danger"},[n._v("\n                            "+n._s(n.form.errors.get("name"))+"\n                        ")]):n._e(),n._v(" "),n.currentNameIsDuplicate?e("div",{staticClass:"alert alert-warning",attrs:{role:"alert",id:"nameDuplicate"}},[n._v("\n                            Foi encontrado uma pessoa com este mesmo nome:\n                            "+n._s(n.form.fields.name)+", recomenda-se verificar\n                            as pessoas cadastradas.\n                        ")]):n._e(),n._v(" "),e("app-input",{directives:[{name:"mask",rawName:"v-mask",value:"###.###.###-##",expression:"'###.###.###-##'"}],attrs:{name:"cpf",label:"CPF",required:!1,form:n.form},model:{value:n.form.fields.cpf,callback:function(t){n.$set(n.form.fields,"cpf",t)},expression:"form.fields.cpf"}}),n._v(" "),e("app-input",{attrs:{name:"nickname",label:"Nome pÃºblico",required:!0,form:n.form},model:{value:n.form.fields.nickname,callback:function(t){n.$set(n.form.fields,"nickname",t)},expression:"form.fields.nickname"}}),n._v(" "),e("app-input",{attrs:{name:"title",label:"Tratamento",required:!0,form:n.form},model:{value:n.form.fields.title,callback:function(t){n.$set(n.form.fields,"title",t)},expression:"form.fields.title"}}),n._v(" "),e("app-input",{attrs:{name:"birthdate",label:"Data de nascimento",type:"date",form:n.form},model:{value:n.form.fields.birthdate,callback:function(t){n.$set(n.form.fields,"birthdate",t)},expression:"form.fields.birthdate"}})],1)]),n._v(" "),e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 text-right mb-3"},[e("button",{staticClass:"btn btn-outline-secondary",attrs:{type:"submit"},on:{click:function(t){t.preventDefault(),n.savePerson()}}},[n._v("\n                            gravar\n                        ")]),n._v(" "),e("router-link",{staticClass:"btn btn-success",attrs:{to:"/people",tag:"button"}},[n._v("\n                            cancelar\n                        ")])],1)])])])])])},[],!1,null,null,null);u.options.__file="PeopleForm.vue";t.default=u.exports},RFgL:function(n,t,e){"use strict";var i=e("iB00");e.n(i).a},WPQR:function(n,t,e){"use strict";var i=e("L2JU");function r(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{},i=Object.keys(e);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(e).filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),i.forEach(function(t){o(n,t,e[t])})}return n}function o(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}t.a={data:function(){return{people_current:{id:"null"}}},methods:r({},Object(i.mapActions)("people",["clearForm"]),{makePhotoUrl:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;n||(n=this.people.form.fields.photoUrl),n||(n=this.people.selected.photoUrl);var t=this.people_current.id!=this.people.selected.id;return this.people_current.id=this.people.selected.id,flush_image_cache(n,t)}}),computed:r({},Object(i.mapState)({people:function(n){return n.people},personInstitutions:function(n){return n.personInstitutions},contacts:function(n){return n.contacts},addresses:function(n){return n.addresses},personCategories:function(n){return n.personCategories},advisors:function(n){return n.advisors},advisorContacts:function(n){return n.advisorContacts}}))}},iB00:function(n,t,e){var i=e("v9lD");"string"==typeof i&&(i=[[n.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};e("aET+")(i,r);i.locals&&(n.exports=i.locals)},jx1L:function(n,t,e){"use strict";t.a={data:function(){return{loading:{environment:!1,table:!1}}},computed:{filterText:{get:function(){return this.$store.state[this.service.name].data.filter.text},set:function(n){return this.$store.dispatch(this.service.name+"/mutateSetQueryFilterText",n)}},emptyForm:function(){return this.$store.state[this.service.name].emptyForm},form:function(){return this.$store.state[this.service.name].form},selected:function(){return this.$store.state[this.service.name].selected},environment:function(){return this.$store.state.environment},pagination:function(){return this.$store.state[this.service.name].data.links?this.$store.state[this.service.name].data.links.pagination:{}},perPage:{get:function(){return this.pagination.per_page},set:function(n){this.$store.dispatch(this.service.name+"/setPerPage",n)}}},methods:{load:function(){return this.$store.commit(this.service.name+"/mutateSetPerPage",this.environment.user.per_page),this.$store.dispatch(this.service.name+"/load")},select:function(n){return this.$store.dispatch(this.service.name+"/select",n)},save:function(n){return this.$store.dispatch(this.service.name+"/save",n)},mutateSetErrors:function(n){this.$store.commit(this.service.name+"/mutateSetErrors",n)},mutateFormData:function(n){this.$store.commit(this.service.name+"/mutateFormData",n)},mutateSetFormField:function(n){this.$store.commit(this.service.name+"/mutateSetFormField",n)},mutateSetService:function(n){this.$store.commit(this.service.name+"/mutateSetService",n)},isLoading:function(){return this.loading.environment||this.loading.table},boot:function(){var n=this;this.mutateSetService(this.service),!this.service.hasOwnProperty("performLoad")||this.service.performLoad?this.load().then(function(){n.fillFormWhenEditing()}):this.fillFormWhenEditing(),this.$store.dispatch(this.service.name+"/subscribeToTableEvents")},fillFormWhenEditing:function(){var n=this,t="update"===this.mode?_.find(this.rows,function(t){return t.id===n.$route.params.id}):this.form?clone(this.emptyForm):{};this.mutateFormData(t),this.mutateSetErrors({}),this.fillAdditionalFormFields()},fillAdditionalFormFields:function(){},back:function(){this.$router.back()},saveModel:function(){var n=this;this.save(this.mode).then(function(){n.back(),n.clearForm()})},can:function(n){return n&&!1},cannot:function(n){return!can(n)},gotoPage:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(e=e||this.pagination).current_page!==n&&(n<1||n>e.last_page||this.$store.dispatch((t||this.service.name)+"/setCurrentPage",n))},isCurrent:function(n,t){return n.id===t.id},setPerPage:function(){this.$store.commit(this.service.name+"/mutateSetPerPage",this.environment.user.per_page)},getDataUrl:function(){return buildApiUrl(this.service.uri,this.$store.state)},getStoreUrl:function(){return buildApiUrl(this.service.uri,this.$store.state)},getUpdateStoreUrl:function(){return buildApiUrl(this.service.uri,this.$store.state)}},mounted:function(){this.boot()}}},v9lD:function(n,t,e){(n.exports=e("I1BE")(!1)).push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",""])}}]);
webpackJsonp([15],{"8nzx":function(t,e,i){"use strict";e.a={data:function(){return{loading:{environment:!1,table:!1}}},computed:{filterText:{get:function(){return this.$store.state[this.service.name].data.filter.text},set:function(t){return this.$store.dispatch(this.service.name+"/mutateSetQueryFilterText",t)}},emptyForm:function(){return this.$store.state[this.service.name].emptyForm},form:function(){return this.$store.state[this.service.name].form},selected:function(){return this.$store.state[this.service.name].selected},environment:function(){return this.$store.state.environment},pagination:function(){return this.$store.state[this.service.name].data.links?this.$store.state[this.service.name].data.links.pagination:{}},perPage:{get:function(){return this.pagination.per_page},set:function(t){this.$store.dispatch(this.service.name+"/setPerPage",t)}}},methods:{load:function(){return this.$store.commit(this.service.name+"/mutateSetPerPage",this.environment.user.per_page),this.$store.dispatch(this.service.name+"/load")},select:function(t){return this.$store.dispatch(this.service.name+"/select",t)},save:function(t){return this.$store.dispatch(this.service.name+"/save",t)},mutateSetErrors:function(t){this.$store.commit(this.service.name+"/mutateSetErrors",t)},mutateFormData:function(t){this.$store.commit(this.service.name+"/mutateFormData",t)},mutateSetFormField:function(t){this.$store.commit(this.service.name+"/mutateSetFormField",t)},mutateSetService:function(t){this.$store.commit(this.service.name+"/mutateSetService",t)},isLoading:function(){return this.loading.environment||this.loading.table},boot:function(){var t=this;this.mutateSetService(this.service),!this.service.hasOwnProperty("performLoad")||this.service.performLoad?this.load().then(function(){t.fillFormWhenEditing()}):this.fillFormWhenEditing(),this.$store.dispatch(this.service.name+"/subscribeToTableEvents")},fillFormWhenEditing:function(){var t=this,e="update"===this.mode?_.find(this.rows,function(e){return e.id===t.$route.params.id}):this.form?clone(this.emptyForm):{};this.mutateFormData(e),this.mutateSetErrors({}),this.fillAdditionalFormFields()},fillAdditionalFormFields:function(){},back:function(){this.$router.back()},saveModel:function(){var t=this;this.save(this.mode).then(function(){t.back(),t.clearForm()})},can:function(t){return t&&!1},cannot:function(t){return!can(t)},gotoPage:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(i=i||this.pagination).current_page!==t&&(t<1||t>i.last_page||this.$store.dispatch((e||this.service.name)+"/setCurrentPage",t))},isCurrent:function(t,e){return t.id===e.id},setPerPage:function(){this.$store.commit(this.service.name+"/mutateSetPerPage",this.environment.user.per_page)},getDataUrl:function(){return buildApiUrl(this.service.uri,this.$store.state)},getStoreUrl:function(){return buildApiUrl(this.service.uri,this.$store.state)},getUpdateStoreUrl:function(){return buildApiUrl(this.service.uri,this.$store.state)}},mounted:function(){this.boot()}}},KOnr:function(t,e,i){"use strict";var o=i("NYxO"),r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t};e.a={data:function(){return{people_current:{id:"null"}}},methods:r({},Object(o.mapActions)("people",["clearForm"]),{makePhotoUrl:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t||(t=this.people.form.fields.photoUrl),t||(t=this.people.selected.photoUrl);var e=this.people_current.id!=this.people.selected.id;return this.people_current.id=this.people.selected.id,flush_image_cache(t,e)}}),computed:r({},Object(o.mapState)({people:function(t){return t.people},personInstitutions:function(t){return t.personInstitutions},contacts:function(t){return t.contacts},addresses:function(t){return t.addresses},personCategories:function(t){return t.personCategories},advisors:function(t){return t.advisors},advisorContacts:function(t){return t.advisorContacts}}))}},Rqvo:function(t,e,i){var o=i("mJ1x");"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);i("rjj0")("58c8b19e",o,!0,{})},VlS6:function(t,e,i){var o=i("VU/8")(i("tNuX"),i("wO2/"),!1,function(t){i("Rqvo")},null,null);t.exports=o.exports},mJ1x:function(t,e,i){(t.exports=i("FZ+f")(!1)).push([t.i,"",""])},tNuX:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i("8nzx"),r=i("KOnr"),s=i("NYxO"),n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t},a={name:"people",uri:"people",performLoad:!1};e.default={props:["mode"],mixins:[o.a,r.a],data:function(){return{service:a,photo:null,photoUrl:"https://dummyimage.com/200x200/fff/aaa",photoBlob:null,showCropper:!1,currentNameIsDuplicate:!1}},methods:n({},Object(s.mapActions)(a.name,["selectPerson"]),{generatePhoto:function(){var t=this;this.mutatePhotoUrl(this.photo.generateDataUrl()),this.photo.generateBlob(function(e){t.mutatePhoto(e)},"image/jpeg",.85)},usePhoto:function(){this.generatePhoto(),this.showCropper=!1},mutatePhoto:function(t){var e=this;blob_to_base64(t,function(i){e.mutateSetFormField({field:"photo",value:t.type+";"+i})})},mutatePhotoUrl:function(t){this.mutateSetFormField({field:"photoUrl",value:t})},flushImageCache:function(t){return flush_image_cache(t)},verifyDuplicateName:function(t){var e=this;clearTimeout(this.timeout),this.currentNameIsDuplicate=!1,this.timeout=setTimeout(function(){post("/api/v1/people/validate-name",{name:t}).catch(function(t){e.currentNameIsDuplicate=!0,console.log(t)})},500)},confirmNameDuplicate:function(){var t=this;confirm("Deseja realmente cadastrar novamente o nome: "+this.form.fields.name+"?",this).then(function(e){e&&t.saveModel()})},savePerson:function(){this.currentNameIsDuplicate?this.confirmNameDuplicate():this.saveModel()}}),computed:{photoUrlField:function(){return flush_image_cache(this.form.fields.photoUrl)}}}},"wO2/":function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"py-2 text-center"},[i("h2",[t._v(t._s("create"===this.mode?"Nova ":"Editar ")+"Pessoa")]),t._v(" "),i("h2",[t._v(t._s(t.form.fields.name?t.form.fields.name:""))])]),t._v(" "),i("div",{staticClass:"row justify-content-center"},[i("div",{staticClass:"col-8"},[i("form",[i("div",{staticClass:"row"},[i("div",{staticClass:"col-12"},[i("img",{staticClass:"img-thumbnail rounded mx-auto d-block",attrs:{src:t.makePhotoUrl(),width:"200",height:"200"},on:{click:function(e){t.showCropper=!0}}}),t._v(" "),i("b-modal",{attrs:{id:"croppaModal","body-class":"mx-auto",centered:""},model:{value:t.showCropper,callback:function(e){t.showCropper=e},expression:"showCropper"}},[i("vue-croppa",{attrs:{placeholder:"Selecione uma imagem",width:400,height:400,"prevent-white-space":!0},model:{value:t.photo,callback:function(e){t.photo=e},expression:"photo"}}),t._v(" "),i("div",{staticClass:"w-100",attrs:{slot:"modal-footer"},slot:"modal-footer"},[i("div",{staticClass:"float-right btn btn-success",on:{click:function(e){t.showCropper=!1}}},[t._v("\n                                    Cancelar\n                                ")]),t._v(" "),i("div",{staticClass:"float-right btn btn-outline-secondary mr-2",on:{click:function(e){t.usePhoto()}}},[t._v("\n                                    OK\n                                ")])])],1)],1)]),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"col-12 mb-3"},[i("label",{staticClass:"mb-0 mt-2",attrs:{for:"name"}},[t._v("Nome")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.form.fields.name,expression:"form.fields.name"}],staticClass:"form-control",attrs:{name:"name",id:"name",required:"required"},domProps:{value:t.form.fields.name},on:{keyup:function(e){t.verifyDuplicateName(t.form.fields.name)},input:function(e){e.target.composing||t.$set(t.form.fields,"name",e.target.value)}}}),t._v(" "),t.form.errors.has("name")?i("div",{staticClass:"text-danger"},[t._v("\n                            "+t._s(t.form.errors.get("name"))+"\n                        ")]):t._e(),t._v(" "),t.currentNameIsDuplicate?i("div",{staticClass:"alert alert-warning",attrs:{role:"alert",id:"nameDuplicate"}},[t._v("\n                            Foi encontrado uma pessoa com este mesmo nome: "+t._s(t.form.fields.name)+", recomenda-se verificar as pessoas cadastradas.\n                        ")]):t._e(),t._v(" "),i("app-input",{directives:[{name:"mask",rawName:"v-mask",value:"###.###.###-##",expression:"'###.###.###-##'"}],attrs:{name:"cpf",label:"CPF",required:!1,form:t.form},model:{value:t.form.fields.cpf,callback:function(e){t.$set(t.form.fields,"cpf",e)},expression:"form.fields.cpf"}}),t._v(" "),i("app-input",{attrs:{name:"nickname",label:"Nome pÃºblico",required:!0,form:t.form},model:{value:t.form.fields.nickname,callback:function(e){t.$set(t.form.fields,"nickname",e)},expression:"form.fields.nickname"}}),t._v(" "),i("app-input",{attrs:{name:"title",label:"Tratamento",required:!0,form:t.form},model:{value:t.form.fields.title,callback:function(e){t.$set(t.form.fields,"title",e)},expression:"form.fields.title"}}),t._v(" "),i("app-input",{attrs:{name:"birthdate",label:"Data de nascimento",type:"date",form:t.form},model:{value:t.form.fields.birthdate,callback:function(e){t.$set(t.form.fields,"birthdate",e)},expression:"form.fields.birthdate"}})],1)]),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"col-12 text-right mb-3"},[i("button",{staticClass:"btn btn-outline-secondary",attrs:{type:"submit"},on:{click:function(e){e.preventDefault(),t.savePerson()}}},[t._v("\n                            gravar\n                        ")]),t._v(" "),i("router-link",{staticClass:"btn btn-success",attrs:{to:"/people",tag:"button"}},[t._v("\n                            cancelar\n                        ")])],1)])])])])])},staticRenderFns:[]}}});